#!/bin/bash
if ( test "$1" = "" || test "$2" = "") then
   echo Usage:  ./deploy VERSION_NUMBER_NCI VERSION_NUMBER_REGULAR
   echo 'NCI should usually be one higher than regular version number'
   exit 1
fi

# init/earthmask.rgb  # disable for now
ncisuffix='__nci'
uplstring='init/Helvetica.txf \
         init/Courier-Bold.txf \
         init/earthday4096.jpg \
         init/splash.png \
         init/earthnight4096.jpg \
         init/logo.jpg'
# ntpversion='ntpdate_4.2.4p7_'
ntpversion='ntpdate_4.2.4p5_'
if ( test "`uname -s`" = "Darwin" ) then
  # Apple Mac -- universal!
  suffixp='powerpc-apple-darwin'
  suffixi='i686-apple-darwin'
  suffixs='x86_64-apple-darwin'
  ntpdvi=$ntpversion$suffixi
  ntpdvp=$ntpversion$suffixp
  ntpdvs=$ntpversion$suffixs
  rm -f qcnlive-mac.zip
  zip -r qcnlive-mac.zip QCNLive.app \
     init/$ntpversion*apple* $uplstring \
     init/libMotionNodeAccelAPI.dylib \
       -x@exclude.lst
  cp qcnusb.app/Contents/MacOS/qcnusb ../qcnusb/install
  cd ../qcnusb/install
  /Developer/usr/bin/packagemaker --doc installer.pmdoc --out ../../bin/qcnusb-mac.mpkg
  cd ../../bin/
  zip -r qcnusb-mac.zip qcnusb-mac.mpkg -x@exclude.lst
  lipo -extract i386 qcn.app/Contents/MacOS/qcn -output qcn_$1_$suffixi$ncisuffix
  lipo -extract i386 qcn.app/Contents/MacOS/qcn -output qcn_$2_$suffixi
  lipo -extract ppc qcn.app/Contents/MacOS/qcn -output qcn_$1_$suffixp$ncisuffix
  lipo -extract ppc qcn.app/Contents/MacOS/qcn -output qcn_$2_$suffixp
  lipo -extract x86_64 qcn.app/Contents/MacOS/qcn -output qcn_$1_$suffixs$ncisuffix
  lipo -extract x86_64 qcn.app/Contents/MacOS/qcn -output qcn_$2_$suffixs
  lipo -extract i386 qcn_graphics.app/Contents/MacOS/qcn_graphics -output graphics_app=qcn_graphics_$1_$suffixi
  lipo -extract i386 qcn_graphics.app/Contents/MacOS/qcn_graphics -output graphics_app=qcn_graphics_$2_$suffixi
  lipo -extract ppc qcn_graphics.app/Contents/MacOS/qcn_graphics -output graphics_app=qcn_graphics_$1_$suffixp
  lipo -extract ppc qcn_graphics.app/Contents/MacOS/qcn_graphics -output graphics_app=qcn_graphics_$2_$suffixp
  lipo -extract x86_64 qcn_graphics.app/Contents/MacOS/qcn_graphics -output graphics_app=qcn_graphics_$1_$suffixs
  lipo -extract x86_64 qcn_graphics.app/Contents/MacOS/qcn_graphics -output graphics_app=qcn_graphics_$2_$suffixs

appspathone=qcn_$1_$suffixi$ncisuffix
appspathtwo=qcn_$2_$suffixi
appspaththree=qcn_$1_$suffixp$ncisuffix
appspathfour=qcn_$2_$suffixp
appspathfive=qcn_$1_$suffixs$ncisuffix
appspathsix=qcn_$2_$suffixs

rm -f qcnsftp.up
echo chdir /var/www/boinc/sensor/download >> qcnsftp.up
echo put \*.zip >> qcnsftp.up
echo chdir /var/www/boinc/sensor/apps/qcnsensor >> qcnsftp.up
echo -mkdir $appspathone >> qcnsftp.up
echo chdir $appspathone >> qcnsftp.up
echo put qcn_$1_$suffixi$ncisuffix >> qcnsftp.up
echo put graphics_app=qcn_graphics_$1_$suffixi >> qcnsftp.up
echo put init/Helvetica.txf >> qcnsftp.up
echo put init/Courier-Bold.txf >> qcnsftp.up
#echo put init/earthmask.rgb >> qcnsftp.up
echo put init/earthday4096.jpg >> qcnsftp.up
echo put init/earthnight4096.jpg >> qcnsftp.up
echo put init/$ntpdvi >> qcnsftp.up
echo put init/logo.jpg >> qcnsftp.up
if ( test "`uname -s`" = "Darwin" ) then
   echo put init/libMotionNodeAccelAPI.dylib >> qcnsftp.up
else
   echo put init/libMotionNodeAccelAPI.so >> qcnsftp.up
fi
echo chdir ../ >> qcnsftp.up
echo -mkdir $appspathtwo >> qcnsftp.up
echo chdir $appspathtwo >> qcnsftp.up
echo put qcn_$2_$suffixi >> qcnsftp.up
echo put graphics_app=qcn_graphics_$2_$suffixi >> qcnsftp.up
echo put init/Helvetica.txf >> qcnsftp.up
echo put init/Courier-Bold.txf >> qcnsftp.up
#echo put init/earthmask.rgb >> qcnsftp.up
echo put init/earthday4096.jpg >> qcnsftp.up
echo put init/earthnight4096.jpg >> qcnsftp.up
echo put init/$ntpdvi >> qcnsftp.up
echo put init/logo.jpg >> qcnsftp.up
if ( test "`uname -s`" = "Darwin" ) then
   echo put init/libMotionNodeAccelAPI.dylib >> qcnsftp.up
else
   echo put init/libMotionNodeAccelAPI.so >> qcnsftp.up
fi

echo chdir /var/www/boinc/sensor/download >> qcnsftp.up
echo put \*.zip >> qcnsftp.up
echo chdir /var/www/boinc/sensor/apps/qcnsensor >> qcnsftp.up
echo -mkdir $appspaththree >> qcnsftp.up
echo chdir $appspaththree >> qcnsftp.up
echo put qcn_$1_$suffixp$ncisuffix >> qcnsftp.up
echo put graphics_app=qcn_graphics_$1_$suffixp >> qcnsftp.up
echo put init/Helvetica.txf >> qcnsftp.up
echo put init/Courier-Bold.txf >> qcnsftp.up
#echo put init/earthmask.rgb >> qcnsftp.up
echo put init/earthday4096.jpg >> qcnsftp.up
echo put init/earthnight4096.jpg >> qcnsftp.up
echo put init/$ntpdvp >> qcnsftp.up
echo put init/logo.jpg >> qcnsftp.up
if ( test "`uname -s`" = "Darwin" ) then
   echo put init/libMotionNodeAccelAPI.dylib >> qcnsftp.up
else
   echo put init/libMotionNodeAccelAPI.so >> qcnsftp.up
fi
echo chdir ../ >> qcnsftp.up
echo -mkdir $appspathfour >> qcnsftp.up
echo chdir $appspathfour >> qcnsftp.up
echo put qcn_$2_$suffixp >> qcnsftp.up
echo put graphics_app=qcn_graphics_$2_$suffixp >> qcnsftp.up
echo put init/Helvetica.txf >> qcnsftp.up
echo put init/Courier-Bold.txf >> qcnsftp.up
#echo put init/earthmask.rgb >> qcnsftp.up
echo put init/earthday4096.jpg >> qcnsftp.up
echo put init/earthnight4096.jpg >> qcnsftp.up
echo put init/$ntpdvp >> qcnsftp.up
echo put init/logo.jpg >> qcnsftp.up
if ( test "`uname -s`" = "Darwin" ) then
   echo put init/libMotionNodeAccelAPI.dylib >> qcnsftp.up
else
   echo put init/libMotionNodeAccelAPI.so >> qcnsftp.up
fi

echo chdir /var/www/boinc/sensor/download >> qcnsftp.up
echo put \*.zip >> qcnsftp.up
echo chdir /var/www/boinc/sensor/apps/qcnsensor >> qcnsftp.up
echo -mkdir $appspathfive >> qcnsftp.up
echo chdir $appspathfive >> qcnsftp.up
echo put qcn_$1_$suffixs$ncisuffix >> qcnsftp.up
echo put graphics_app=qcn_graphics_$1_$suffixs >> qcnsftp.up
echo put init/Helvetica.txf >> qcnsftp.up
echo put init/Courier-Bold.txf >> qcnsftp.up
#echo put init/earthmask.rgb >> qcnsftp.up
echo put init/earthday4096.jpg >> qcnsftp.up
echo put init/earthnight4096.jpg >> qcnsftp.up
echo put init/$ntpdvs >> qcnsftp.up
echo put init/logo.jpg >> qcnsftp.up
if ( test "`uname -s`" = "Darwin" ) then
   echo put init/libMotionNodeAccelAPI.dylib >> qcnsftp.up
else
   echo put init/libMotionNodeAccelAPI.so >> qcnsftp.up
fi
echo chdir ../ >> qcnsftp.up
echo -mkdir $appspathsix >> qcnsftp.up
echo chdir $appspathsix >> qcnsftp.up
echo put qcn_$2_$suffixs >> qcnsftp.up
echo put graphics_app=qcn_graphics_$2_$suffixs >> qcnsftp.up
echo put init/Helvetica.txf >> qcnsftp.up
echo put init/Courier-Bold.txf >> qcnsftp.up
#echo put init/earthmask.rgb >> qcnsftp.up
echo put init/earthday4096.jpg >> qcnsftp.up
echo put init/earthnight4096.jpg >> qcnsftp.up
echo put init/$ntpdvs >> qcnsftp.up
echo put init/logo.jpg >> qcnsftp.up
if ( test "`uname -s`" = "Darwin" ) then
   echo put init/libMotionNodeAccelAPI.dylib >> qcnsftp.up
else
   echo put init/libMotionNodeAccelAPI.so >> qcnsftp.up
fi

echo exit >> qcnsftp.up
sftp -b qcnsftp.up carlgt1@qcn-web


else
   # Linux -- uname -p below returns 'unknown'!
   # suffix=`uname -p`-pc-linux-gnu
   suffix=i686-pc-linux-gnu
   ntpdv=$ntpversion$suffix
   cp qcn_$1_$suffix qcn_$1_$suffix$ncisuffix
   mv qcn_$1_$suffix qcn_$2_$suffix
   cp graphics_app=qcn_graphics_$1_$suffix graphics_app=qcn_graphics_$2_$suffix
   rm -f qcnlive-linux.zip
   zip -r qcnlive-linux.zip qcnlive init/Helvetica.txf init/Courier-Bold.txf init/earthmask.rgb init/earthday4096.jpg \
         init/$ntpdv $uplstring \
         init/libMotionNodeAccelAPI.so \
            -x@exclude.lst
appspathone=qcn_$1_$suffix$ncisuffix
appspathtwo=qcn_$2_$suffix
rm -f qcnsftp.up
echo chdir /var/www/boinc/sensor/download >> qcnsftp.up
echo put \*.zip >> qcnsftp.up
echo chdir /var/www/boinc/sensor/apps/qcnsensor >> qcnsftp.up
echo -mkdir $appspathone >> qcnsftp.up
echo chdir $appspathone >> qcnsftp.up
echo put qcn_$1_$suffix$ncisuffix >> qcnsftp.up
echo put graphics_app=qcn_graphics_$1_$suffix >> qcnsftp.up
echo put init/Helvetica.txf >> qcnsftp.up
echo put init/Courier-Bold.txf >> qcnsftp.up
#echo put init/earthmask.rgb >> qcnsftp.up
echo put init/earthday4096.jpg >> qcnsftp.up
echo put init/earthnight4096.jpg >> qcnsftp.up
echo put init/$ntpdv >> qcnsftp.up
echo put init/logo.jpg >> qcnsftp.up
if ( test "`uname -s`" = "Darwin" ) then
   echo put init/libMotionNodeAccelAPI.dylib >> qcnsftp.up
else
   echo put init/libMotionNodeAccelAPI.so >> qcnsftp.up
fi
echo chdir ../ >> qcnsftp.up
echo -mkdir $appspathtwo >> qcnsftp.up
echo chdir $appspathtwo >> qcnsftp.up
echo put qcn_$2_$suffix >> qcnsftp.up
echo put graphics_app=qcn_graphics_$2_$suffix >> qcnsftp.up
echo put init/Helvetica.txf >> qcnsftp.up
echo put init/Courier-Bold.txf >> qcnsftp.up
#echo put init/earthmask.rgb >> qcnsftp.up
echo put init/earthday4096.jpg >> qcnsftp.up
echo put init/earthnight4096.jpg >> qcnsftp.up
echo put init/$ntpdv >> qcnsftp.up
echo put init/logo.jpg >> qcnsftp.up
if ( test "`uname -s`" = "Darwin" ) then
   echo put init/libMotionNodeAccelAPI.dylib >> qcnsftp.up
else
   echo put init/libMotionNodeAccelAPI.so >> qcnsftp.up
fi
echo exit >> qcnsftp.up
sftp -b qcnsftp.up carlgt1@qcn-web 
fi
